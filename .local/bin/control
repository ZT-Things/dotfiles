#!/bin/bash

# control script for Hyprland

HOTKEY_DIR=~/scripts/hotkeys

DND_STATE_FILE="$HOME/.cache/dnd_state"

if [ "$1" = "lock" ]; then
    nohup env XDG_RUNTIME_DIR=/run/user/1000 WAYLAND_DISPLAY=wayland-1 hyprlock >/dev/null 2>&1 &
    echo "Hyprland screen locked."

elif [ "$1" = "hotkey" ]; then
    KEY="$2"
    SCRIPT="$3"

    if [[ "$KEY" =~ ^[1-9]$ ]]; then
        DEST="$HOTKEY_DIR/$KEY.sh"

        if [ ! -f "$SCRIPT" ]; then
            echo "Error: Script '$SCRIPT' not found."
            exit 1
        fi

        mkdir -p "$HOTKEY_DIR"

        cp "$SCRIPT" "$DEST"
        chmod +x "$DEST"

        echo "Assigned '$SCRIPT' to hotkey $KEY â†’ $DEST"
    else
        echo "Error: Hotkey must be a number from 1 to 9."
        exit 1
    fi

elif [ "$1" = "dnd" ]; then
	if [ "$(makoctl mode)" == "do-not-disturb" ]; then
	# DND OFF
		makoctl mode -r do-not-disturb && echo "DND Mode OFF"
        echo "off" > "$DND_STATE_FILE"
	else
	# DND ON
		makoctl mode -s do-not-disturb && echo "DND Mode ON"
        echo "on" > "$DND_STATE_FILE"
	fi

else
    echo "Usage:"
    echo "  control lock                 # Lock screen with hyprlock"
    echo "  control hotkey <1-9> <file>  # Assign script to numpad hotkey"
    echo "  control dnd                  # Toggle do-not-disturb mode, uses mako"
    exit 1
fi
